var SnapCar=function(a,b){if(a.canDefineProperty="function"==typeof Object.defineProperty,a.canDefineProperty)try{Object.defineProperty({},"x",{})}catch(c){a.canDefineProperty=!1}a.canDefineProperty?Object.defineProperties(a,{baseDomain:{enumerable:!0,writable:!0,value:"https://api.snapcar.com/public"},token:{enumerable:!0,writable:!0},locale:{enumerable:!0,writable:!0,value:"en"},fallbackLocale:{enumerable:!0,writable:!1,value:"en"}}):(a.baseDomain="https://api.snapcar.com/public",a.locale="fr",a.fallbackLocale="fr"),a.defineProperties=function(c,d){b.each(d,function(a,c){d[a].propertyDescriptors=b.extend({},{enumerable:!0,writable:!1,configurable:!1},c.propertyDescriptors||{})});var e=b.extend({},c.prototype._mapping||{},d);if(a.canDefineProperty?Object.defineProperties(c.prototype,{_mapping:{enumerable:!1,configurable:!0,writable:!1,value:e}}):c.prototype._mapping=e,a.canDefineProperty){var f={};b.each(d,function(a,b){f[b.name]=b.propertyDescriptors}),Object.defineProperties(c.prototype,f)}},a.getTextInLocale=function(b){return b[a.locale]||b[a.fallbackLocale]},a.processObjectPayload=function(c,d,e){var f=[];b.each(d||{},function(d,g){if("object"==typeof c._mapping){var h=c._mapping[d];"object"==typeof h&&(value="undefined"!=typeof e?e(d,g)||g:g,!a.canDefineProperty||h.propertyDescriptors.writable?c[h.name]=value:f[h.name]=b.extend({},h.propertyDescriptors,{value:value,configurable:!0}))}}),a.canDefineProperty&&Object.defineProperties(c,f)},a.bootstrapInstanceProperties=function(c){if(a.canDefineProperty){var d=[];b.each(c._mapping,function(a,c){d[c.name]=b.extend({},!0,c.propertyDescriptors.clone,{writable:!0,configurable:!0})}),Object.defineProperties(c,d)}},a.Error=function(b,c,d){a.processObjectPayload(this,{type:b,message:c,description:d})},a.defineProperties(a.Error,{type:{name:"type"},message:{name:"message"},description:{name:"description"}}),a.ConfigError=function(b,c){a.processObjectPayload(this,{type:"config",message:b,description:c})},a.ConfigError.prototype=new a.Error,a.InvalidParametersError=function(b,c){a.processObjectPayload(this,{type:"invalid_parameters",message:b,description:c})},a.InvalidParametersError.prototype=new a.Error,a.APIError=function(c){var d;"undefined"!=typeof c.responseJSON&&(d=c.responseJSON),"object"==typeof d?a.processObjectPayload(this,b.extend({},d,{description:"An API error occurred. Check the message parameter for more details.",type:"api"})):a.processObjectPayload(this,b.extend({},d,{message:"other",description:"An error occurred while sending the request.",server_response:d,type:"api"}))},a.APIError.prototype=new a.Error,a.defineProperties(a.APIError,{code:{name:"code"},details:{name:"details"},server_response:{name:"serverResponse"}}),a.ServiceClass=function(){a.bootstrapInstanceProperties(this)},a.ServiceClass.populateProperties=function(b,c){return a.processObjectPayload(b,c,function(b,c){switch(b){case"name":return a.getTextInLocale(c)}}),b},a.defineProperties(a.ServiceClass,{id:{name:"id"},name:{name:"name"}}),a.MeetingPoint=function(){a.bootstrapInstanceProperties(this)},a.MeetingPoint.populateProperties=function(b,c){return a.processObjectPayload(b,c,function(b,c){switch(b){case"name":case"rdv_point":return a.getTextInLocale(c)}}),b},a.defineProperties(a.MeetingPoint,{id:{name:"id"},name:{name:"name"},rdv_point:{name:"rdvPoint"}}),a.SpecialArea=function(){a.bootstrapInstanceProperties(this)},a.SpecialArea.populateProperties=function(c,d){return a.processObjectPayload(c,d,function(c,d){switch(c){case"name":case"menu_name":return a.getTextInLocale(d);case"meeting_points":case"meeting_points_nameboard":return b.map(d,function(b){return a.MeetingPoint.populateProperties(new a.MeetingPoint,b)})}}),c},a.defineProperties(a.SpecialArea,{id:{name:"id"},name:{name:"name"},menu_name:{name:"menuName"},selection_required:{name:"selectionRequired"},area_type:{name:"areaType"},meeting_points:{name:"meetingPoints"},meeting_points_nameboard:{name:"meetingPointsNameboard"}}),a.SpecialAreaTypes={STATION:"station",AIRPORT:"airport",NORMAL:"normal"},a.ETAResult=function(){a.bootstrapInstanceProperties(this)},a.ETAResult.populateProperties=function(b,c){return a.processObjectPayload(b,c,function(b,c){switch(b){case"service_class":return a.ServiceClass.populateProperties(new a.ServiceClass,c)}}),b},a.defineProperties(a.ETAResult,{status:{name:"status"},eta:{name:"eta"},service_class:{name:"serviceClass"}}),a.ETAResultStatuses={OK:"ok",UNAVAILABLE:"unavailable"},a.PaymentMethod=function(){a.bootstrapInstanceProperties(this)},a.PaymentMethod.populateProperties=function(b,c){return a.processObjectPayload(b,c),b},a.defineProperties(a.PaymentMethod,{id:{name:"id"},name:{name:"name"},type:{name:"type"},number:{name:"number"},brand:{name:"brand"}}),a.Rider=function(){a.bootstrapInstanceProperties(this)},a.Rider.populateProperties=function(b,c){return a.processObjectPayload(b,c,function(b,c){switch(b){case"payment_method":return a.PaymentMethod.populateProperties(new a.PaymentMethod,c)}}),b},a.defineProperties(a.Rider,{id:{name:"id"},firstname:{name:"firstname"},lastname:{name:"lastname"},email:{name:"email"},status:{name:"status"},payment_method:{name:"paymentMethod"}}),a.RiderStatuses={BOOKING_ALLOWED:"booking_allowed",BOOKING_NOT_ALLOWED:"booking_not_allowed",SUSPENDED:"suspended"},a.BookingPrice=function(){a.bootstrapInstanceProperties(this)},a.BookingPrice.populateProperties=function(b,c){return a.processObjectPayload(b,c,function(b,c){switch(b){case"expiry_date":return new Date(1e3*parseInt(c));case"service_class":return a.ServiceClass.populateProperties(new a.ServiceClass,c)}}),b},a.defineProperties(a.BookingPrice,{id:{name:"id"},price:{name:"price"},currency:{name:"currency"},formatted_price:{name:"formattedPrice"},expiry_date:{name:"expiryDate"},service_class:{name:"serviceClass"},booking:{name:"booking"}}),a.BookingPrice.prototype.confirm=function(){var b={};"undefined"!=typeof this.booking.driverInfo&&(b.driver_info=this.booking.driverInfo),"undefined"!=typeof this.booking.meetingPoint&&(b.meeting_point_id=this.booking.meetingPoint.id);var c=this.booking,e=a.performAPICall({url:a.baseDomain+"/bookings/prices/"+this.id+"/confirm",method:"POST",data:b},function(a){return c.constructor.populateProperties(c,a),c});return d(c,e)},a.CancellationFee=function(){a.bootstrapInstanceProperties(this)},a.CancellationFee.populateProperties=function(b,c){return a.processObjectPayload(b,c),b},a.defineProperties(a.CancellationFee,{charged:{name:"charged"},amount:{name:"amount"},currency:{name:"currency"},formatted_amount:{name:"formattedAmount"}}),a.Address=function(b,c,d,e){a.bootstrapInstanceProperties(this),this.name=b,this.city=c,this.postalCode=d,this.country=e},a.Address.populateProperties=function(b,c){return a.processObjectPayload(b,c),b},a.defineProperties(a.Address,{name:{name:"name"},postal_code:{name:"postalCode"},city:{name:"city"},country:{name:"country"}}),a.Location=function(b,c,d){a.bootstrapInstanceProperties(this),this.lat=b,this.lng=c,this.address=d},a.Location.populateProperties=function(b,c){return a.processObjectPayload(b,c,function(b,c){switch(b){case"address":return a.Address.populateProperties(new a.Address,c)}}),b},a.defineProperties(a.Location,{lat:{name:"lat"},lng:{name:"lng"},address:{name:"address"}}),a.GeoPoint=function(){a.bootstrapInstanceProperties(this)},a.GeoPoint.populateProperties=function(b,c){return a.processObjectPayload(b,c),b},a.defineProperties(a.GeoPoint,{lat:{name:"lat"},lng:{name:"lng"}}),a.BillingDocument=function(){a.bootstrapInstanceProperties(this)},a.BillingDocument.populateProperties=function(b,c){return a.processObjectPayload(b,c),b},a.defineProperties(a.BillingDocument,{id:{name:"id"},url:{name:"url"},type:{name:"type"}}),a.BillingDocumentTypes={BILL:"bill",CREDIT_NOTE:"credit_note"},a.Vehicle=function(){a.bootstrapInstanceProperties(this)},a.Vehicle.populateProperties=function(b,c){return a.processObjectPayload(b,c,function(b,c){switch(b){case"model":case"color":return a.getTextInLocale(c);case"position":return a.GeoPoint.populateProperties(new a.GeoPoint,c)}}),b},a.defineProperties(a.Vehicle,{model:{name:"model"},color:{name:"color"},position:{name:"position"},plate_number:{name:"plateNumber"}}),a.Driver=function(){a.bootstrapInstanceProperties(this)},a.Driver.populateProperties=function(b,c){return a.processObjectPayload(b,c),b},a.defineProperties(a.Driver,{name:{name:"name"},phone_number:{name:"phoneNumber"},id:{name:"id"}}),a.TimestampedPoint=function(){a.bootstrapInstanceProperties(this)},a.TimestampedPoint.populateProperties=function(b,c){return a.processObjectPayload(b,c),b},a.defineProperties(a.TimestampedPoint,{timestamp:{name:"date"},lat:{name:"lat"},lng:{name:"lng"}}),a.BookingHistory=function(b){this.limit=b||20,a.bootstrapInstanceProperties(this)},a.BookingHistory.populateProperties=function(c,d){return a.processObjectPayload(c,d,function(c,d){switch(c){case"history":return b.map(d,function(b){return a.Booking.populateProperties(new a.Booking,b)})}}),c},a.defineProperties(a.BookingHistory,{total:{name:"total"},offset:{name:"offset"},count:{name:"count"},history:{name:"history"}}),a.BookingHistory.prototype.nextBookings=function(){if(this.moreBookingsAvailable())return a.bookingsHistory(this.offset+this.limit,this.limit);throw new a.InvalidParametersError("no_more_bookings","There are no more bookings available in the history. Make sure that the moreBookingsAvailable method returns true before trying to load more bookings.")},a.BookingHistory.prototype.moreBookingsAvailable=function(){return parseInt(this.offset)+parseInt(this.count)<parseInt(this.total)},a.Booking=function(b,c,d,e,f,g,h){a.bootstrapInstanceProperties(this),this.rider=b,this.startLocation=c,this.endLocation=d,this.plannedStartDate=e,this.nameboard=f,this.driverInfo=g,this.meetingPoint=h},a.Booking.populateProperties=function(c,d){return a.processObjectPayload(c,d,function(c,d){switch(c){case"planned_start_date":case"creation_date":case"driver_arrival_date":case"start_date":case"end_date":case"cancellation_date":return new Date(1e3*parseInt(d));case"service_class":return a.ServiceClass.populateProperties(new a.ServiceClass,d);case"meeting_point":return a.MeetingPoint.populateProperties(new a.MeetingPoint,d);case"start_location":case"end_location":return a.Location.populateProperties(new a.Location,d);case"driver":return a.Driver.populateProperties(new a.Driver,d);case"rider":return a.Rider.populateProperties(new a.Rider,d);case"vehicle":return a.Vehicle.populateProperties(new a.Vehicle,d);case"route":return b.map(d,function(b){return a.TimestampedPoint.populateProperties(new a.TimestampedPoint,b)});case"documents":return b.map(d,function(b){return a.BillingDocument.populateProperties(new a.BillingDocument,b)});case"booking_price":return a.BookingPrice.populateProperties(new a.BookingPrice,d)}}),c},a.defineProperties(a.Booking,{id:{name:"id"},rider:{name:"rider"},service_class:{name:"serviceClass"},status:{name:"status"},timezone:{name:"timezone"},planned_start_date:{name:"plannedStartDate"},creation_date:{name:"creationDate"},driver_arrival_date:{name:"driverArrivalDate"},start_date:{name:"startDate"},meeting_point:{name:"meetingPoint"},end_date:{name:"endDate"},cancellation_date:{name:"cancellationDate"},cancellation_reason:{name:"cancellationReason"},start_location:{name:"startLocation"},end_location:{name:"endLocation"},driver_info:{name:"driverInfo"},booking_price:{name:"bookingPrice"},billed_amount:{name:"billedAmount"},vat_amount:{name:"vatAmount"},tip:{name:"tip"},route:{name:"route"},documents:{name:"documents"},vehicle:{name:"vehicle"}}),a.Booking.prototype.cancellationPrice=function(){return a.performAPICall({url:a.baseDomain+"/bookings/"+this.id+"/cancellation_price"},function(b){var c=new a.CancellationFee;return c.constructor.populateProperties(c,b),c})},a.Booking.prototype.cancel=function(){var b=this;return a.performAPICall({url:a.baseDomain+"/bookings/"+this.id+"/cancel",method:"POST"},function(a){return b.constructor.populateProperties(b,a),b})},a.Booking.prototype.refresh=function(){var b=this;return a.performAPICall({url:a.baseDomain+"/bookings/"+b.id},function(a){return b.constructor.populateProperties(b,a),b})},a._orderParameters=function(){var a={start_location:{lat:this.startLocation.lat,lng:this.startLocation.lng,address:{name:this.startLocation.address.name,city:this.startLocation.address.city,postal_code:this.startLocation.address.postalCode,country:this.startLocation.address.country}},end_location:"undefined"!=typeof this.endLocation?{lat:this.endLocation.lat,lng:this.endLocation.lng,address:{name:this.endLocation.address.name,city:this.endLocation.address.city,postal_code:this.endLocation.address.postalCode,country:this.endLocation.address.country}}:void 0,rider_id:this.rider.id,nameboard:"undefined"!=typeof this.nameboard?this.nameboard?1:0:void 0,date:"undefined"!=typeof this.plannedStartDate?parseInt(this.plannedStartDate.getTime()/1e3):void 0};return a};var d=function(c,d){if("undefined"==typeof c.plannedStartDate){var e=b.Deferred();return d.done(function(){e.notify(c);var b=function(){c.refresh().always(function(){c.status===a.BookingStatuses.PENDING?d():e.resolve(c)})},d=function(){setTimeout(b,3e3)};d()}).fail(function(a){e.reject(a)}),e.promise()}return d};if(a.Booking.prototype.confirm=function(){if("undefined"==typeof this.startLocation||"undefined"==typeof this.startLocation.address||"undefined"==typeof this.startLocation.lat||"undefined"==typeof this.startLocation.lng||"undefined"==typeof this.startLocation.address.name||"undefined"==typeof this.startLocation.address.city)throw new a.InvalidParametersError("start_location_missing","You must provide a start location including at least: lat, lng, name and city.");if("undefined"==typeof this.rider)throw new a.InvalidParametersError("rider_missing","You must provide a valid rider.");if("undefined"==typeof this.serviceClass)throw new a.InvalidParametersError("service_class_missing","You must provide the required service class for this booking.");var b=a._orderParameters.call(this);"undefined"!=typeof this.driverInfo&&(b.driver_info=this.driverInfo),"undefined"!=typeof this.meetingPoint&&(b.meeting_point_id=this.meetingPoint.id),b.service_class_id=this.serviceClass.id;var c=this,e=a.performAPICall({url:a.baseDomain+"/bookings",method:"POST",data:b},function(a){return c.constructor.populateProperties(c,a),c});return d(c,e)},a.Booking.prototype.flatPrices=function(){if("undefined"==typeof this.startLocation||"undefined"==typeof this.startLocation.address||"undefined"==typeof this.startLocation.lat||"undefined"==typeof this.startLocation.lng||"undefined"==typeof this.startLocation.address.name||"undefined"==typeof this.startLocation.address.city)throw new a.InvalidParametersError("start_location_missing","You must provide a start location including at least: lat, lng, name and city.");if("undefined"==typeof this.endLocation||"undefined"==typeof this.endLocation.address||"undefined"==typeof this.endLocation.lat||"undefined"==typeof this.endLocation.lng||"undefined"==typeof this.endLocation.address.name||"undefined"==typeof this.endLocation.address.city)throw new a.InvalidParametersError("end_location_missing","You must provide an end location including at least: lat, lng, name and city.");if("undefined"==typeof this.rider)throw new a.InvalidParametersError("rider_missing","You must provide a valid rider.");var c=a._orderParameters.call(this),d=this;return a.performAPICall({url:a.baseDomain+"/bookings/prices",method:"POST",data:c},function(c){return b.map(c,function(c){var e=new a.BookingPrice;return e.constructor.populateProperties(b.extend(e,{booking:d}),c),e})})},a.BookingStatuses={PENDING:"pending",GOING_TO_GET:"going_to_get",DRIVER_WAITING:"driver_waiting",ON_BOARD:"on_board",COMPLETE:"complete",CANCELLED:"cancelled"},a.BookingCancellationReasons={RIDER_CANCELLATION:"rider_cancellation",RIDER_CANCELLATION_CHARGED:"rider_cancellation_charged",SYSTEM_CANCELLATION:"system_cancellation",SYSTEM_CANCELLATION_CHARGED:"system_cancellation_charged",NO_DRIVER:"no_driver"},"undefined"==typeof b)throw new a.Error("missing_jquery","jQuery is required to run the SnapCar SDK.");return a.performAPICall=function(c,d,e){if(("undefined"==typeof e||e)&&"undefined"==typeof a.token)throw new a.Error("missing_token","You have to provide a SnapCar API token in order to perform API calls.");var f=b.Deferred();c.data=b.extend({},c.data||{},{token:a.token});var g=b.ajax(c).done(function(a){f.resolve(d(a))}).fail(function(b){f.reject(new a.APIError(b))}),h=f.promise();return h._abort=function(){g.abort()},h},a.abortRequest=function(a){a._abort()},a.eta=function(c,d){return a.performAPICall({url:a.baseDomain+"/info/eta",data:{lat:c,lng:d}},function(c){return b.map(c,function(b){var c=new a.ETAResult;return c.constructor.populateProperties(c,b),c})})},a.serviceClasses=function(c,d){return a.performAPICall({url:a.baseDomain+"/info/service_classes",data:{lat:c,lng:d}},function(c){return b.map(c,function(b){var c=new a.ServiceClass;return c.constructor.populateProperties(c,b),c})})},a.meetingPoints=function(b,c){return a.performAPICall({url:a.baseDomain+"/info/meeting_points",data:{lat:b,lng:c}},function(b){var c=new a.SpecialArea;return c.constructor.populateProperties(c,b),c})},a.user=function(){return a.performAPICall({url:a.baseDomain+"/users/me"},function(b){var c=new a.Rider(b);return c.constructor.populateProperties(c,b),c})},a.activeBookings=function(){return a.performAPICall({url:a.baseDomain+"/bookings"},function(c){return b.map(c,function(b){var c=new a.Booking;return c.constructor.populateProperties(c,b),c})})},a.bookingsHistory=function(b,c){return a.performAPICall({url:a.baseDomain+"/bookings/history",data:{offset:b||0,limit:c||20}},function(b){var d=new a.BookingHistory(c);return d.constructor.populateProperties(d,b),d})},a.booking=function(b){return a.performAPICall({url:a.baseDomain+"/bookings/"+b},function(b){var c=new a.Booking;return c.constructor.populateProperties(c,b),c})},a}(SnapCar||{},jQuery);