var SnapCar=function(e,t){function n(e,n){if(t.each(n,function(e,o){n[e].propertyDescriptors=t.extend({},{enumerable:!0,writable:!1,configurable:!1},o.propertyDescriptors||{})}),e.mapping=t.extend({},e.mapping||{},n),o){var i={};t.each(n,function(e,t){i[t.name]=t.propertyDescriptors}),Object.defineProperties(e.prototype,i)}}var o="function"==typeof Object.defineProperty;if(o)try{Object.defineProperty({},"x",{})}catch(i){o=!1}o?Object.defineProperties(e,{baseDomain:{enumerable:!0,writable:!0,value:"https://api.snapcar.com/public"},token:{enumerable:!0,writable:!0},locale:{enumerable:!0,writable:!0,value:"en"},fallbackLocale:{enumerable:!0,writable:!1,value:"en"}}):(e.baseDomain="https://api.snapcar.com/public",e.locale="fr",e.fallbackLocale="fr");var r=function(t){return t[e.locale]||t[e.fallbackLocale]},a=function(e,n,i){var r=[];t.each(n||{},function(n,a){if("object"==typeof e.constructor.mapping){var s=e.constructor.mapping[n];"object"==typeof s&&(value="undefined"!=typeof i?i(n,a)||a:a,!o||s.propertyDescriptors.writable?e[s.name]=value:r[s.name]=t.extend({},s.propertyDescriptors,{value:value,configurable:!0}))}}),o&&Object.defineProperties(e,r)},s=function(e){if(o){var n=[];t.each(e.constructor.mapping,function(e,o){n[o.name]=t.extend({},!0,o.propertyDescriptors.clone,{writable:!0,configurable:!0})}),Object.defineProperties(e,n)}};e.Error=function(e,t,n){a(this,{type:e,message:t,description:n})},n(e.Error,{type:{name:"type"},message:{name:"message"},description:{name:"description"}}),e.ConfigError=function(e,t){a(this,{type:"config",message:e,description:t})},e.ConfigError.prototype=new e.Error,e.InvalidParametersError=function(e,t){a(this,{type:"invalid_parameters",message:e,description:t})},e.InvalidParametersError.prototype=new e.Error,e.APIError=function(e){var n;"undefined"!=typeof e.responseJSON&&(n=e.responseJSON),"object"==typeof n?a(this,t.extend({},n,{description:"An API error occurred. Check the message parameter for more details.",type:"api"})):a(this,t.extend({},n,{message:"other",description:"An error occurred while sending the request.",server_response:n,type:"api"}))},e.APIError.prototype=new e.Error,n(e.APIError,{code:{name:"code"},details:{name:"details"},server_response:{name:"serverResponse"}}),e.ServiceClass=function(){s(this)},e.ServiceClass.populateProperties=function(e,t){return a(e,t,function(e,t){switch(e){case"name":return r(t)}}),e},n(e.ServiceClass,{id:{name:"id"},name:{name:"name"}}),e.MeetingPoint=function(){s(this)},e.MeetingPoint.populateProperties=function(e,t){return a(e,t,function(e,t){switch(e){case"name":case"rdv_point":return r(t)}}),e},n(e.MeetingPoint,{id:{name:"id"},name:{name:"name"},rdv_point:{name:"rdvPoint"}}),e.SpecialArea=function(){s(this)},e.SpecialArea.populateProperties=function(n,o){return a(n,o,function(n,o){switch(n){case"name":case"menu_name":return r(o);case"meeting_points":case"meeting_points_nameboard":return t.map(o,function(t){return e.MeetingPoint.populateProperties(new e.MeetingPoint,t)})}}),n},n(e.SpecialArea,{id:{name:"id"},name:{name:"name"},menu_name:{name:"menuName"},selection_required:{name:"selectionRequired"},area_type:{name:"areaType"},meeting_points:{name:"meetingPoints"},meeting_points_nameboard:{name:"meetingPointsNameboard"}}),e.SpecialAreaTypes={STATION:"station",AIRPORT:"airport",NORMAL:"normal"},e.ETAResult=function(){s(this)},e.ETAResult.populateProperties=function(t,n){return a(t,n,function(t,n){switch(t){case"service_class":return e.ServiceClass.populateProperties(new e.ServiceClass,n)}}),t},n(e.ETAResult,{status:{name:"status"},eta:{name:"eta"},service_class:{name:"serviceClass"}}),e.ETAResultStatuses={OK:"ok",UNAVAILABLE:"unavailable"},e.PaymentMethod=function(){s(this)},e.PaymentMethod.populateProperties=function(e,t){return a(e,t),e},n(e.PaymentMethod,{id:{name:"id"},name:{name:"name"},type:{name:"type"},number:{name:"number"},brand:{name:"brand"}}),e.Rider=function(){s(this)},e.Rider.populateProperties=function(t,n){return a(t,n,function(t,n){switch(t){case"payment_method":return e.PaymentMethod.populateProperties(new e.PaymentMethod,n)}}),t},n(e.Rider,{id:{name:"id"},firstname:{name:"firstname"},lastname:{name:"lastname"},email:{name:"email"},status:{name:"status"},payment_method:{name:"payment_method"}}),e.RiderStatuses={BOOKING_ALLOWED:"booking_allowed",BOOKING_NOT_ALLOWED:"booking_not_allowed",SUSPENDED:"suspended"},e.BookingPrice=function(){s(this)},e.BookingPrice.populateProperties=function(e,t){return a(e,t,function(e,t){switch(e){case"expiry_date":return new Date(1e3*parseInt(t))}}),e},n(e.BookingPrice,{id:{name:"id"},price:{name:"price"},currency:{name:"currency"},formatted_price:{name:"formattedPrice"},expiry_date:{name:"expiryDate"},service_class_id:{name:"serviceClassId"},booking:{name:"booking"}}),e.BookingPrice.prototype.confirm=function(){var t={};"undefined"!=typeof this.booking.driverInfo&&(t.driver_info=this.booking.driverInfo),"undefined"!=typeof this.booking.meetingPoint&&(t.meeting_point_id=this.booking.meetingPoint.id);var n=this.booking,o=d({url:e.baseDomain+"/bookings/prices/"+this.id+"/confirm",method:"POST",data:t},function(e){return n.constructor.populateProperties(n,e),n});return u(n,o)},e.CancellationFee=function(){s(this)},e.CancellationFee.populateProperties=function(e,t){return a(e,t),e},n(e.CancellationFee,{charged:{name:"charged"},amount:{name:"amount"},currency:{name:"currency"},formatted_amount:{name:"formattedAmount"}}),e.Address=function(e,t,n,o){s(this),this.name=e,this.city=t,this.postalCode=n,this.country=o},e.Address.populateProperties=function(e,t){return a(e,t),e},n(e.Address,{name:{name:"name"},postal_code:{name:"postalCode"},city:{name:"city"},country:{name:"country"}}),e.Location=function(e,t,n){s(this),this.lat=e,this.lng=t,this.address=n},e.Location.populateProperties=function(t,n){return a(t,n,function(t,n){switch(t){case"address":return e.Address.populateProperties(new e.Address,n)}}),t},n(e.Location,{lat:{name:"lat"},lng:{name:"lng"},address:{name:"address"}}),e.GeoPoint=function(){s(this)},e.GeoPoint.populateProperties=function(e,t){return a(e,t),e},n(e.GeoPoint,{lat:{name:"lat"},lng:{name:"lng"}}),e.BillingDocument=function(){s(this)},e.BillingDocument.populateProperties=function(e,t){return a(e,t),e},n(e.BillingDocument,{id:{name:"id"},url:{name:"url"},type:{name:"type"}}),e.BillingDocumentTypes={BILL:"bill",CREDIT_NOTE:"credit_note"},e.Vehicle=function(){s(this)},e.Vehicle.populateProperties=function(t,n){return a(t,n,function(t,n){switch(t){case"model":case"color":return r(n);case"position":return e.GeoPoint.populateProperties(new e.GeoPoint,n)}}),t},n(e.Vehicle,{model:{name:"model"},color:{name:"color"},position:{name:"position"},plate_number:{name:"plateNumber"}}),e.Driver=function(){s(this)},e.Driver.populateProperties=function(e,t){return a(e,t),e},n(e.Driver,{name:{name:"name"},phone:{name:"phone"},id:{name:"id"}}),e.TimestampedPoint=function(){s(this)},e.TimestampedPoint.populateProperties=function(e,t){return a(e,t),e},n(e.TimestampedPoint,{timestamp:{name:"date"},lat:{name:"lat"},lng:{name:"lng"}}),e.BookingHistory=function(e){this.limit=e||20,s(this)},e.BookingHistory.populateProperties=function(n,o){return a(n,o,function(n,o){switch(n){case"history":return t.map(o,function(t){return e.Booking.populateProperties(new e.Booking,t)})}}),n},n(e.BookingHistory,{total:{name:"total"},offset:{name:"offset"},count:{name:"count"},history:{name:"history"}}),e.BookingHistory.prototype.nextBookings=function(){if(this.moreBookingsAvailable())return e.bookingsHistory(this.offset+this.limit,this.limit);throw new e.InvalidParametersError("no_more_bookings","There are no more bookings available in the history. Make sure that the moreBookingsAvailable method returns true before trying to load more bookings.")},e.BookingHistory.prototype.moreBookingsAvailable=function(){return parseInt(this.offset)+parseInt(this.count)<parseInt(this.total)},e.Booking=function(e,t,n,o,i,r,a){s(this),this.rider=e,this.startLocation=t,this.endLocation=n,this.plannedStartDate=o,this.nameboard=i,this.driverInfo=r,this.meetingPoint=a},e.Booking.populateProperties=function(n,o){return a(n,o,function(n,o){switch(n){case"planned_start_date":case"creation_date":case"driver_arrival_date":case"start_date":case"end_date":case"cancellation_date":return new Date(1e3*parseInt(o));case"service_class":return e.ServiceClass.populateProperties(new e.ServiceClass,o);case"meeting_point":return e.MeetingPoint.populateProperties(new e.MeetingPoint,o);case"start_location":case"end_location":return e.Location.populateProperties(new e.Location,o);case"driver":return e.Driver.populateProperties(new e.Driver,o);case"rider":return e.Rider.populateProperties(new e.Rider,o);case"vehicle":return e.Vehicle.populateProperties(new e.Vehicle,o);case"route":return t.map(o,function(t){return e.TimestampedPoint.populateProperties(new e.TimestampedPoint,t)});case"documents":return t.map(o,function(t){return e.BillingDocument.populateProperties(new e.BillingDocument,t)});case"booking_price":return e.BookingPrice.populateProperties(new e.BookingPrice,o)}}),n},n(e.Booking,{id:{name:"id"},rider:{name:"rider"},service_class:{name:"serviceClass"},status:{name:"status"},timezone:{name:"timezone"},planned_start_date:{name:"plannedStartDate"},creation_date:{name:"creationDate"},driver_arrival_date:{name:"driverArrivalDate"},start_date:{name:"startDate"},meeting_point:{name:"meetingPoint"},end_date:{name:"endDate"},cancellation_date:{name:"cancellationDate"},cancellation_reason:{name:"cancellationReason"},start_location:{name:"startLocation"},end_location:{name:"endLocation"},driver_info:{name:"driverInfo"},booking_price:{name:"bookingPrice"},billed_amount:{name:"billedAmount"},vat_amount:{name:"vatAmount"},tip:{name:"tip"},route:{name:"route"},documents:{name:"documents"},vehicle:{name:"vehicle"}}),e.Booking.prototype.cancellationPrice=function(){return d({url:e.baseDomain+"/bookings/"+this.id+"/cancellation_price"},function(t){var n=new e.CancellationFee;return n.constructor.populateProperties(n,t),n})},e.Booking.prototype.cancel=function(){var t=this;return d({url:e.baseDomain+"/bookings/"+this.id+"/cancel",method:"POST"},function(e){return t.constructor.populateProperties(t,e),t})},e.Booking.prototype.refresh=function(){var t=this;return d({url:e.baseDomain+"/bookings/"+t.id},function(e){return t.constructor.populateProperties(t,e),t})};var c=function(){var e={start_location:{lat:this.startLocation.lat,lng:this.startLocation.lng,address:{name:this.startLocation.address.name,city:this.startLocation.address.city,postal_code:this.startLocation.address.postalCode,country:this.startLocation.address.country}},end_location:"undefined"!=typeof this.endLocation?{lat:this.endLocation.lat,lng:this.endLocation.lng,address:{name:this.endLocation.address.name,city:this.endLocation.address.city,postal_code:this.endLocation.address.postalCode,country:this.endLocation.address.country}}:void 0,rider_id:this.rider.id,nameboard:"undefined"!=typeof this.nameboard?this.nameboard?1:0:void 0,date:"undefined"!=typeof this.plannedStartDate?parseInt(this.plannedStartDate.getTime()/1e3):void 0};return e},u=function(n,o){if("undefined"==typeof n.plannedStartDate){var i=t.Deferred();return o.done(function(){i.notify(n);var t=function(){n.refresh().always(function(){n.status===e.BookingStatuses.PENDING?o():i.resolve(n)})},o=function(){setTimeout(t,3e3)};o()}).fail(function(e){i.reject(e)}),i.promise()}return o};if(e.Booking.prototype.confirm=function(){if("undefined"==typeof this.startLocation||"undefined"==typeof this.startLocation.address||"undefined"==typeof this.startLocation.lat||"undefined"==typeof this.startLocation.lng||"undefined"==typeof this.startLocation.address.name||"undefined"==typeof this.startLocation.address.city)throw new e.InvalidParametersError("start_location_missing","You must provide a start location including at least: lat, lng, name and city.");if("undefined"==typeof this.rider)throw new e.InvalidParametersError("rider_missing","You must provide a valid rider.");if("undefined"==typeof this.serviceClass)throw new e.InvalidParametersError("service_class_missing","You must provide the required service class for this booking.");var t=c.call(this);"undefined"!=typeof this.driverInfo&&(t.driver_info=this.driverInfo),"undefined"!=typeof this.meetingPoint&&(t.meeting_point_id=this.meetingPoint.id),t.service_class_id=this.serviceClass.id;var n=this,o=d({url:e.baseDomain+"/bookings",method:"POST",data:t},function(e){return n.constructor.populateProperties(n,e),n});return u(n,o)},e.Booking.prototype.flatPrices=function(){if("undefined"==typeof this.startLocation||"undefined"==typeof this.startLocation.address||"undefined"==typeof this.startLocation.lat||"undefined"==typeof this.startLocation.lng||"undefined"==typeof this.startLocation.address.name||"undefined"==typeof this.startLocation.address.city)throw new e.InvalidParametersError("start_location_missing","You must provide a start location including at least: lat, lng, name and city.");if("undefined"==typeof this.endLocation||"undefined"==typeof this.endLocation.address||"undefined"==typeof this.endLocation.lat||"undefined"==typeof this.endLocation.lng||"undefined"==typeof this.endLocation.address.name||"undefined"==typeof this.endLocation.address.city)throw new e.InvalidParametersError("end_location_missing","You must provide an end location including at least: lat, lng, name and city.");if("undefined"==typeof this.rider)throw new e.InvalidParametersError("rider_missing","You must provide a valid rider.");var n=c.call(this),o=this;return d({url:e.baseDomain+"/bookings/prices",method:"POST",data:n},function(n){return t.map(n,function(n){var i=new e.BookingPrice;return i.constructor.populateProperties(t.extend(i,{booking:o}),n),i})})},e.BookingStatuses={PENDING:"pending",GOING_TO_GET:"going_to_get",DRIVER_WAITING:"driver_waiting",ON_BOARD:"on_board",COMPLETE:"complete",CANCELLED:"cancelled"},e.BookingCancellationReasons={RIDER_CANCELLATION:"rider_cancellation",RIDER_CANCELLATION_CHARGED:"rider_cancellation_charged",SYSTEM_CANCELLATION:"system_cancellation",SYSTEM_CANCELLATION_CHARGED:"system_cancellation_charged",NO_DRIVER:"no_driver"},"undefined"==typeof t)throw new e.Error("missing_jquery","jQuery is required to run the SnapCar SDK.");var d=function(n,o){if("undefined"==typeof e.token)throw new e.Error("missing_token","You have to provide a SnapCar API token in order to perform API calls.");var i=t.Deferred();return n.data=t.extend({},n.data||{},{token:e.token}),t.ajax(n).done(function(e){i.resolve(o(e))}).fail(function(t){i.reject(new e.APIError(t))}),i.promise()};return e.eta=function(n,o){return d({url:e.baseDomain+"/info/eta",data:{lat:n,lng:o}},function(n){return t.map(n,function(t){var n=new e.ETAResult;return n.constructor.populateProperties(n,t),n})})},e.serviceClasses=function(n,o){return d({url:e.baseDomain+"/info/service_classes",data:{lat:n,lng:o}},function(n){return t.map(n,function(t){var n=new e.ServiceClass;return n.constructor.populateProperties(n,t),n})})},e.meetingPoints=function(t,n){return d({url:e.baseDomain+"/info/meeting_points",data:{lat:t,lng:n}},function(t){var n=new e.SpecialArea;return n.constructor.populateProperties(n,t),n})},e.user=function(){return d({url:e.baseDomain+"/users/me"},function(t){var n=new e.Rider(t);return n.constructor.populateProperties(n,t),n})},e.activeBookings=function(){return d({url:e.baseDomain+"/bookings"},function(n){return t.map(n,function(t){var n=new e.Booking;return n.constructor.populateProperties(n,t),n})})},e.bookingsHistory=function(t,n){return d({url:e.baseDomain+"/bookings/history",data:{offset:t||0,limit:n||20}},function(t){var o=new e.BookingHistory(n);return o.constructor.populateProperties(o,t),o})},e.booking=function(t){return d({url:e.baseDomain+"/bookings/"+t},function(t){var n=new e.Booking;return n.constructor.populateProperties(n,t),n})},e}(SnapCar||{},jQuery);